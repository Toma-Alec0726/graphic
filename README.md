# 習字画像から「文字のみ」抽出ツール（ブラウザ版）

**紙の皺や反射のムラを避けつつ、文字部分だけを抜き出し、背景を透明/白で出力できるPNGを生成**するシングルHTMLツールです。インストール不要、**ブラウザ単体**で動きます。

## 🌐 ツールURL

**https://toma-alec0726.github.io/graphic/calligraphy_cleaner.html**

---

## 使い方
1. 画面上部の **「ファイルを選択」** から画像を読み込みます。
2. **しきい値モード**を選択：
   - **Otsu＋補正**（推奨）: 画像のヒストグラムから自動算出されたしきい値に、補正オフセット（±100）を加えて調整。
   - **固定しきい値**: 0〜255 の絶対値を指定（**基準値 40** が初期設定）。
3. 右側のスライダーで調整し、**「処理する」** を押すとプレビューが表示。
4. **「PNGを保存」** でダウンロードできます。

### 調整パラメータ（UI右側）
- **Otsuしきい値補正**（±100）／**固定しきい値（0〜255）**
- **ぼかし半径**（`0〜3`）: 紙のムラを軽く均します。
- **極小黒点の除去（面積px）**: 連結成分の面積しきい値で削除。**基準値 100**。
- **形状整形（膨張→収縮）サイズ**（例: `3`）: 軽い途切れ補正と滑らかさ。
- **黒一色に統一**（ON/OFF）: ONでRGBを `#000000` に固定。OFFで濃淡保持。
- **自動トリミング**（ON/OFF）: 外接矩形で余白を最小化。
- **背景を透明にする**（ON/OFF）: OFFで背景を**白・不透明**にします。

---

## アルゴリズム概要
1. **グレースケール化** → **簡易ガウシアンぼかし**（紙のムラ緩和）
2. **Otsuの二値化**（または**固定しきい値**）で前景/背景を分離
3. **連結成分の面積フィルタ**で極小黒点ノイズを削除（基準値100）
4. **膨張→収縮（クロージング）**で途切れを補い、過度な潰れを避けつつ滑らかに
5. **アルファ合成**：
   - 背景透明ON → 背景は `alpha=0`
   - 背景透明OFF → 背景は**白・不透明**
6. **外接矩形トリミング**で余白を最小化

> すべてブラウザの Canvas API 上で動作し、外部ライブラリは使っていません。

---

## 動作環境
- **Chrome / Edge / Firefox / Safari** 最新版を推奨
- 画像サイズは**数メガピクセル程度**までが快適です（ブラウザのメモリに依存）
- 完全オフラインで動作（ローカルHTML実行）

---

## よくある調整のコツ
- **文字内部の空白が黒く埋まる** → Otsu補正を負方向（例: `-15〜-20`）、または**固定しきい値**で小さめ（例: `35〜45`）。整形サイズを下げる/0に。
- **細線が欠ける** → Otsu補正を緩め（例: `-5〜0`）、整形サイズを `3〜5` に。
- **黒点が残る** → 面積しきい値を上げる（例: `100→150`）。
- **濃淡を活かす** → 「黒一色に統一」をOFFに。
- **背景を透過しない** → 「背景を透明にする」のチェックを外す（白背景で出力）。
